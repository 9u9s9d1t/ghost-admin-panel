<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ghost Admin Pro</title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --border: #30363d; --text: #c9d1d9; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; padding: 20px; }
        .container { max-width: 1300px; margin: 0 auto; }
        .panel { background: var(--panel); padding: 15px; border-radius: 8px; border: 1px solid var(--border); display: flex; gap: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: #000; font-size: 11px; color: #8b949e; text-transform: uppercase; }
        .btn { padding: 6px 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; color: white; font-weight: bold; font-size: 13px; }
        .btn-blue { background: #1f6feb; } .btn-green { background: #238636; } .btn-red { background: #da3633; }
        .btn-purple { background: #8957e5; } .btn-cyan { background: #0891b2; } .btn-orange { background: #d29922; }
        input, select { background: #000; border: 1px solid var(--border); color: #00ff00; padding: 8px; border-radius: 5px; }
        .modal { display: none; position: fixed; left:0; top:0; width:100%; height:100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index:1000; }
        .modal-content { background: var(--panel); margin: 5% auto; padding: 25px; width: 400px; border: 1px solid var(--border); border-radius: 12px; }
        label { display: block; margin-top: 15px; color: #8b949e; font-size: 11px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>GhostType Pro <small style="color: #444; font-size: 12px;">Kyiv Time</small></h1>
        <div class="panel">
            <input type="text" id="gt" placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –≤—Å–µ—Ö..." style="flex-grow:1">
            <button class="btn btn-blue" onclick="act('set_text','all',{text:document.getElementById('gt').value})">–í–°–ï–ú</button>
            <button class="btn btn-red" onclick="if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ—Ö?'))act('reset','all')">–°–ë–†–û–° –í–°–ï–•</button>
        </div>
        <table>
            <thead><tr><th>–°–û–¢–†–£–î–ù–ò–ö</th><th>MSG</th><th>CPM</th><th>–°–¢–ê–¢–£–°</th><th>–î–ï–ô–°–¢–í–ò–Ø</th></tr></thead>
            <tbody id="tb"></tbody>
        </table>
    </div>

    <div id="cfgM" class="modal">
        <div class="modal-content">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–ö</h3>
            <label>–ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label> <input type="text" id="cn" style="width:95%">
            <label>–°–∫–æ—Ä–æ—Å—Ç—å:</label> <input type="number" id="cs" step="0.1" style="width:95%">
            <label>–†–µ–∂–∏–º:</label> 
            <select id="cm" style="width:100%"><option value="Type">Type</option><option value="Paste">Paste</option></select>
            <label>–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π:</label> <input type="number" id="ct" style="width:95%">
            <br><br>
            <button class="btn btn-green" onclick="saveCfg()">–°–û–•–†–ê–ù–ò–¢–¨</button> 
            <button class="btn btn-red" onclick="cls()">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>

    <div id="edM" class="modal"><div class="modal-content" style="width:600px"><h3>TXT Editor</h3><textarea id="ea" style="width:100%;height:350px;background:#000;color:#0f0"></textarea><br><br><button class="btn btn-green" onclick="saveT()">–û–ö</button> <button class="btn btn-red" onclick="cls()">–•</button></div></div>
    <div id="shM" class="modal"><div class="modal-content" style="width:80%"><img id="si" style="width:100%"><br><button class="btn btn-red" onclick="cls()">–ó–ê–ö–†–´–¢–¨</button></div></div>
    
    <script>
        let curr = "";
        async function ref() {
            if (document.querySelector('.modal[style*="block"]')) return;
            const res = await fetch('/api/get_workers');
            const ws = await res.json();
            let h = "";
            Object.entries(ws).sort((a,b)=>b[1].total - a[1].total).forEach(([n, w]) => {
                h += `<tr><td><b>${n}</b><br><small>${w.mode} (${w.last_seen})</small></td>
                <td>${w.total}</td><td>${w.cpm}</td>
                <td style="color:${w.status=='–†–ê–ë–û–¢–ê–ï–¢'?'#238636':'#da3633'}">${w.status}</td>
                <td>
                    <button class="btn btn-cyan" onclick="shot('${n}')">üì∏</button>
                    <button class="btn btn-blue" onclick="openE('${n}','${w.phrases}')">TXT</button>
                    <button class="btn btn-purple" onclick="openCfg('${n}',${w.speed},'${w.mode}',${w.total})">‚öôÔ∏è</button>
                    <button class="btn btn-orange" onclick="act('toggle_status','${n}')">‚èØ</button>
                    <button class="btn btn-red" onclick="if(confirm('–£–¥–∞–ª–∏—Ç—å?'))act('delete','${n}')">üóë</button>
                </td></tr>`;
            });
            document.getElementById("tb").innerHTML = h;
        }
        function openCfg(n,s,m,t){ curr=n; document.getElementById('cn').value=n; document.getElementById('cs').value=s; document.getElementById('cm').value=m; document.getElementById('ct').value=t; document.getElementById('cfgM').style.display='block';}
        async function saveCfg(){ await act('set_config',curr,{config:{name:document.getElementById('cn').value, speed:document.getElementById('cs').value, mode:document.getElementById('cm').value, total:document.getElementById('ct').value}}); cls();}
        function openE(n,p){ curr=n; document.getElementById('ea').value=p; document.getElementById('edM').style.display='block';}
        function cls(){ document.querySelectorAll('.modal').forEach(m=>m.style.display='none');}
        async function saveT(){ await act('set_text',curr,{text:document.getElementById('ea').value}); cls();}
        async function act(action,target,data={}){ await fetch('/api/admin_action',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action,target,...data})}); ref();}
        async function shot(n){ await act('shot',n); document.getElementById('shM').style.display='block'; setTimeout(async()=>{ const r=await fetch('/api/get_screenshot/'+n); const d=await r.json(); document.getElementById('si').src="data:image/jpeg;base64,"+d.image; },3000);}
        setInterval(ref, 3000); ref();
    </script>
</body>
</html>
