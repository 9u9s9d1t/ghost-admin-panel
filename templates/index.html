<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ghost Admin Pro</title>
    <style>
        body { background: #0a0a0a; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .panel { background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }
        table { width: 100%; border-collapse: collapse; background: #111; border-radius: 8px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #222; }
        th { background: #000; color: #00ff00; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; text-decoration: none; display: inline-block; }
        .btn-blue { background: #007bff; color: white; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: #dc3545; color: white; }
        .btn-orange { background: #fd7e14; color: white; }
        .btn-purple { background: #6f42c1; color: white; }
        .btn:hover { filter: brightness(1.2); }
        .top-gun { color: gold !important; font-weight: bold; text-shadow: 0 0 10px gold; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: #1a1a1a; margin: 10% auto; padding: 25px; width: 400px; border-radius: 10px; border: 1px solid #00ff00; text-align: center; }
        .input-group { text-align: left; margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: #888; }
        .input-group input, .input-group select { width: 100%; padding: 8px; background: #000; border: 1px solid #444; color: #00ff00; border-radius: 5px; box-sizing: border-box; }
        textarea { width: 100%; height: 200px; background: #000; color: #00ff00; padding: 10px; border-radius: 5px; border: 1px solid #333; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="container">
        <h1>GhostType Control Panel <span id="onlineCounter" style="font-size: 14px; color: #666;"></span></h1>
        <div class="panel">
            <input type="text" id="globalText" style="background:#000; color:#00ff00; border:1px solid #444; padding:8px; border-radius:5px; flex-grow:1" placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –≤—Å–µ—Ö...">
            <button class="btn btn-blue" onclick="adminAction('set_text', 'all', {text: document.getElementById('globalText').value})">–û–¢–ü–†–ê–í–ò–¢–¨ –í–°–ï–ú</button>
            <a href="/api/download_report" class="btn btn-green">üìä –°–ö–ê–ß–ê–¢–¨ –û–¢–ß–ï–¢</a>
            <button class="btn btn-red" onclick="adminAction('reset', 'all')">–°–ë–†–û–° –í–°–ï–•</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>–°–û–¢–†–£–î–ù–ò–ö</th>
                    <th>–°–û–û–ë–©–ï–ù–ò–ô</th>
                    <th>CPM</th>
                    <th>–°–¢–ê–¢–£–°</th>
                    <th>–£–ü–†–ê–í–õ–ï–ù–ò–ï</th>
                </tr>
            </thead>
            <tbody id="workerTable"></tbody>
        </table>
    </div>

    <div id="editorModal" class="modal"><div class="modal-content" style="width: 60%;"><h3>–†–µ–¥–∞–∫—Ç–æ—Ä —Ñ—Ä–∞–∑—ã</h3><textarea id="editArea"></textarea><br><br><button class="btn btn-green" onclick="savePhrases()">–û–ö</button> <button class="btn btn-red" onclick="closeModals()">–ó–ê–ö–†–´–¢–¨</button></div></div>
    
    <div id="configModal" class="modal"><div class="modal-content"><h3>–ö–æ–Ω—Ñ–∏–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
        <div class="input-group"><label>Stage:</label><select id="confMode"><option value="Type">Type</option><option value="Paste">Paste</option></select></div>
        <div class="input-group"><label>–°–∫–æ—Ä–æ—Å—Ç—å:</label><input type="number" step="0.1" id="confSpeed"></div>
        <div class="input-group"><label>–°–æ–æ–±—â–µ–Ω–∏–π:</label><input type="number" id="confTotal"></div>
        <button class="btn btn-green" onclick="saveConfigRemote()">–°–û–•–†–ê–ù–ò–¢–¨</button> <button class="btn btn-red" onclick="closeModals()">–û–¢–ú–ï–ù–ê</button>
    </div></div>

    <script>
        let currentWorker = "";
        async function refreshData() {
            if (document.querySelector('.modal[style*="display: block"]')) return;
            const res = await fetch('/api/get_workers');
            const workers = await res.json();
            let html = "";
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            const sortedEntries = Object.entries(workers).sort((a, b) => a[0].localeCompare(b[0]));
            
            sortedEntries.forEach(([name, w]) => {
                html += `<tr>
                    <td class="${w.cpm > 10 ? 'top-gun' : ''}">${name}<br><small style="color:#555">${w.mode}</small></td>
                    <td>${w.total}</td><td>${w.cpm}</td>
                    <td style="color:${w.status === '–†–ê–ë–û–¢–ê–ï–¢' ? '#00ff00' : '#ff4444'}">${w.status}</td>
                    <td>
                        <button class="btn btn-blue" onclick="openEditor('${name}', \`${w.phrases}\`)">–¢–ï–ö–°–¢</button>
                        <button class="btn btn-purple" onclick="openConfig('${name}', '${w.mode}', ${w.speed}, ${w.total})">–ö–û–ù–§–ò–ì</button>
                        <button class="btn btn-orange" onclick="adminAction('toggle_status', '${name}')">–°–¢–ê–¢–£–°</button>
                        <button class="btn btn-red" onclick="adminAction('reset', '${name}')">–°–ë–†–û–°</button>
                    </td>
                </tr>`;
            });
            document.getElementById("workerTable").innerHTML = html;
        }

        function openEditor(n, p) { currentWorker = n; document.getElementById('editArea').value = p; document.getElementById('editorModal').style.display = 'block'; }
        function openConfig(n, m, s, t) { currentWorker = n; document.getElementById('confMode').value = m; document.getElementById('confSpeed').value = s; document.getElementById('confTotal').value = t; document.getElementById('configModal').style.display = 'block'; }
        function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        
        async function savePhrases() { await adminAction('set_text', currentWorker, {text: document.getElementById('editArea').value}); closeModals(); }
        async function saveConfigRemote() { 
            await adminAction('update_config', currentWorker, {
                mode: document.getElementById('confMode').value,
                speed: document.getElementById('confSpeed').value,
                total: document.getElementById('confTotal').value
            }); 
            closeModals(); 
        }

        async function adminAction(action, target, data = {}) {
            await fetch('/api/admin_action', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action, target, ...data})
            });
            refreshData();
        }

        setInterval(refreshData, 3000); refreshData();
    </script>
</body>
</html>
